<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Turnos Cendditer S.A.S.</title>
  <style>
    /* Paleta de colores y radios de borde */
    :root {
      --color-primary: #00b75b;
      --color-primary-dark: #008f48;
      --color-secondary: #f0fcf5;
      --color-accent: #005e3c;
      --color-text: #00331f;
      --radius-lg: 16px;
      --radius-sm: 8px;
    }

    /* Reset básico y estructura de página */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
        Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--color-primary);
      color: var(--color-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Encabezado con logo y título.  Se usa una fuente serif para el título
       para dotar de mayor elegancia.  El logo aumenta su tamaño para que
       el texto resulte legible. */
    header {
      position: relative;
      padding: 20px 0;
      background: var(--color-primary);
      color: #ffffff;
      text-align: center;
      /* Centrar el título horizontalmente; los elementos absolutos (logo y engranaje) no afectan el flujo */
    }
    header img#logo {
      /* Logo posicionado en la esquina superior izquierda */
      position: absolute;
      left: 20px;
      top: 20px;
      height: 100px;
      object-fit: contain;
    }
    header h1 {
      margin: 0;
      font-size: 2rem;
      font-weight: 700;
      text-transform: uppercase;
      font-family: Georgia, "Times New Roman", Times, serif;
      letter-spacing: 1px;
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    #adminBtn {
      background: none;
      border: none;
      font-size: 28px;
      color: var(--color-secondary);
      cursor: pointer;
      position: absolute;
      right: 20px;
      top: 20px;
    }
    #adminBtn:hover {
      color: #ffffff;
    }

    /* Panel de login y logout */
    #loginPanel {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      max-width: 90vw;
      height: 100vh;
      background: #ffffff;
      box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }
    #loginPanel.open {
      transform: translateX(0);
    }
    #loginPanel header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid #ddd;
    }
    #loginPanel header h2 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
    }
    #loginPanel .close-login {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    #loginPanel form {
      display: flex;
      flex-direction: column;
      padding: 16px;
    }
    #loginPanel form input {
      margin-bottom: 12px;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: var(--radius-sm);
    }
    #loginPanel form button {
      padding: 10px;
      font-size: 1rem;
      background: var(--color-primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
    }
    #loginPanel .logout-section {
      display: flex;
      flex-direction: column;
      padding: 16px;
      flex: 1;
    }
    #loginPanel .logout-section p {
      margin: 0 0 16px;
      font-size: 1rem;
      font-weight: 600;
    }
    #loginPanel .logout-section button {
      padding: 10px;
      font-size: 1rem;
      background: var(--color-primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
    }

    /* Contenedor de tarjetas de áreas */
    #areaContainer {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 24px;
      padding: 40px 20px;
      /* Las tarjetas de área ocuparán el ancho disponible y se centrarán mediante justify-content */
    }
    .area-card {
      background: var(--color-secondary);
      color: var(--color-text);
      border-radius: var(--radius-lg);
      padding: 32px 24px;
      width: 280px;
      min-height: 140px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .area-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
    }
    .area-icon-group {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
    }
    .area-icon-group svg {
      width: 44px;
      height: 44px;
      fill: var(--color-primary);
      margin: 0 6px;
    }
    .area-card span {
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      word-wrap: break-word;
      color: var(--color-text);
    }

    /* Back link */
    #backLink {
      /* Separar el enlace de regreso del logo desplazándolo hacia abajo y ligeramente a la derecha */
      display: inline-block;
      margin-top: 40px;
      margin-left: 32px;
      margin-right: 16px;
      margin-bottom: 8px;
      color: #000;
      text-decoration: none;
      font-size: 0.9rem;
    }
    #backLink:hover {
      text-decoration: underline;
    }
    #areaTitle {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: #ffffff;
      text-transform: uppercase;
    }
    #addWorkerForm {
      background: var(--color-secondary);
      padding: 16px;
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      /* El formulario ocupa la mayor parte del ancho disponible hasta un máximo,
         de forma que el fondo y los campos coincidan en tamaño. */
      max-width: 480px;
      width: 100%;
      box-sizing: border-box;
      margin: 0 auto 24px;
      display: none;
    }
    #addWorkerForm input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      /* Incluir padding y borde en el ancho para que el campo no sobresalga del contenedor */
      box-sizing: border-box;
    }
    #addWorkerForm button {
      width: 100%;
      padding: 10px;
      background: var(--color-primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.9rem;
      /* Asegurar que el botón respete el ancho del contenedor */
      box-sizing: border-box;
    }

    /* Título del formulario de alta de trabajadores */
    #addWorkerForm .form-title {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--color-text);
      text-align: left;
    }

    /* Grid de trabajadores */
    #workerGrid {
      /* Usamos flexbox en lugar de grid para que las tarjetas se distribuyan de manera uniforme
         y permanezcan alineadas como en el diseño deseado (ver imagen 3). */
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 24px;
      padding: 0 16px 40px;
    }
    .worker-card {
      background: var(--color-secondary);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform 0.15s ease;
      /* Asegurar que todas las tarjetas tengan la misma altura.  Este valor se
         establece tomando como referencia los nombres más largos para que no
         deformen el diseño al agregarse nuevos empleados. */
      min-height: 280px;
    }
    .worker-card:hover {
      transform: translateY(-4px);
    }
    .worker-initials {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: var(--color-primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 12px;
      text-transform: uppercase;
    }
    .worker-name {
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      margin: 0;
      word-wrap: break-word;
    }
    .worker-surname {
      font-size: 0.9rem;
      font-weight: 400;
      text-align: center;
      margin: 0;
      word-wrap: break-word;
    }
    .worker-status {
      margin-top: 8px;
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      color: #fff;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
    }
    .whatsapp-btn {
      margin-top: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #25D366;
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      padding: 8px 16px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .whatsapp-btn svg {
      width: 20px;
      height: 20px;
      fill: #fff;
      margin-right: 6px;
    }

    /* Modal */
    #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    #modal {
      background: #fff;
      padding: 24px;
      border-radius: var(--radius-lg);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
      width: 92%;
      max-width: 520px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    #modal .close-modal {
      position: absolute;
      top: 8px;
      right: 12px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #e53935;
    }
    #modal .modal-initials {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--color-primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      font-weight: 600;
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    #modal h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      color: var(--color-text);
    }
    #modal .modal-status {
      margin-top: 6px;
      padding: 4px 8px;
      border-radius: var(--radius-sm);
      display: inline-block;
      font-size: 0.8rem;
      font-weight: 500;
      text-transform: uppercase;
    }
    #modal .schedule-summary {
      background: #455a64;
      color: #fff;
      padding: 12px;
      border-radius: var(--radius-sm);
      margin-top: 12px;
      margin-bottom: 12px;
      font-size: 0.9rem;
    }
    #modal .progress-container {
      background: #cfd8dc;
      border-radius: var(--radius-sm);
      height: 10px;
      position: relative;
      overflow: hidden;
      margin-top: 8px;
    }
    #modal .progress-bar {
      background: var(--color-primary);
      height: 100%;
      width: 0;
    }
    #modal .time-remaining {
      margin-top: 4px;
      font-size: 0.8rem;
      color: var(--color-text);
    }
    #modal table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      margin-bottom: 12px;
    }
    #modal table th,
    #modal table td {
      border: 1px solid #eee;
      padding: 6px;
      font-size: 0.8rem;
      text-align: center;
    }
    #modal table th {
      background: var(--color-secondary);
      font-weight: 600;
    }
    #modal .edit-controls {
      margin-top: 12px;
      display: flex;
      justify-content: space-between;
    }
    #modal .edit-controls button {
      padding: 8px 12px;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.85rem;
    }
    #modal .edit-controls button.save {
      background: var(--color-primary);
      color: #fff;
    }
    #modal .edit-controls button.cancel {
      background: #ccc;
      color: #333;
    }

    #modal .edit-controls button.delete {
      background: #e53935;
      color: #fff;
    }
  </style>
</head>
<body>
  <header>
    <img id="logo" src="logo grisa11.png" alt="Logo Cendditer">
    <h1>Control de Turnos Cendditer S.A.S.</h1>
    <button id="adminBtn" title="Administrar">⚙</button>
  </header>

  <!-- Panel de login y logout -->
  <div id="loginPanel">
    <header>
      <h2 id="loginTitle">Iniciar sesión</h2>
      <button class="close-login">×</button>
    </header>
    <form id="loginForm">
      <input type="text" id="usernameInput" placeholder="Usuario" required>
      <input type="password" id="passwordInput" placeholder="Contraseña" required>
      <button type="submit">Ingresar</button>
    </form>
    <div class="logout-section" style="display:none;">
      <p id="loggedUser"></p>
      <button id="logoutBtn">Cerrar sesión</button>
    </div>
  </div>

  <!-- Contenedor principal -->
  <div id="content">
    <!-- Selección de áreas -->
    <div id="areaSelection" style="display:none;">
      <div id="areaContainer"></div>
    </div>
    <!-- Vista de área -->
    <div id="areaView" style="display:none;">
      <a href="#" id="backLink">← Volver</a>
      <h2 id="areaTitle"></h2>
      <form id="addWorkerForm">
        <h3 class="form-title">Agregar trabajador</h3>
        <input type="text" id="newNombre" placeholder="Nombre" required>
        <input type="text" id="newApellido" placeholder="Apellido" required>
        <input type="text" id="newTelefono" placeholder="Teléfono" required>
        <button type="submit">Agregar</button>
      </form>
      <div id="workerGrid"></div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modal">
      <button class="close-modal">×</button>
      <div class="modal-initials" id="modalInitials"></div>
      <h3 id="modalName"></h3>
      <span id="modalStatus" class="modal-status"></span>
      <div class="schedule-summary" id="scheduleSummary"></div>
      <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
      <div class="time-remaining" id="timeRemaining"></div>
      <table id="scheduleTable"></table>
      <div id="phoneEdit" style="display:none; margin-top:8px;">
        <label for="editTelefono" style="font-size:0.8rem;">Teléfono:</label>
        <input type="text" id="editTelefono" style="width:100%; padding:6px; margin-top:4px; border:1px solid #ccc; border-radius: var(--radius-sm); font-size:0.8rem;">
      </div>
      <div class="edit-controls" id="editControls" style="display:none;">
        <button class="save">Guardar</button>
        <button class="cancel">Cancelar</button>
        <button class="delete" id="deleteWorkerBtn">Eliminar trabajador</button>
      </div>
      <div class="edit-controls" id="defaultControls" style="justify-content: center; display:none;">
        <button id="editBtn" class="save">Editar horarios</button>
      </div>
    </div>
  </div>

  <script>
    /*
     * Script de lógica de la aplicación.  Maneja la autenticación, la vista de
     * selección de áreas, la vista de trabajadores, el modal de detalle y
     * edición de horarios y teléfono, y el cálculo del estado de turno.
     */
    const ORIGINAL_PERSONAL = [
      {
        nombre: "Kevin Daniel",
        apellido: "Narvaez Tex",
        horarios: {
          lunes: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          martes: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          miercoles: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          jueves: [ { inicio: 7.5, fin: 12 }, { inicio: 14, fin: 17 } ],
          viernes: [ { inicio: 7.5, fin: 12 }, { inicio: 14, fin: 17 } ],
          sabado: [ { inicio: 13, fin: 19 } ]
        },
        telefono: "573224808436"
      },
      {
        nombre: "Daniel Esteban",
        apellido: "Pacheco Gutierrez",
        horarios: {
          lunes: [ { inicio: 7, fin: 12 }, { inicio: 14, fin: 17 } ],
          martes: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          miercoles: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          jueves: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          viernes: [ { inicio: 8, fin: 12 }, { inicio: 14, fin: 17 } ],
          sabado: [ { inicio: 6.5, fin: 12.5 } ]
        },
        telefono: "573180980000"
      },
      {
        nombre: "Rafael Ricardo",
        apellido: "Daza Solarte",
        horarios: {
          lunes: [ { inicio: 6.5, fin: 11 }, { inicio: 13, fin: 17 } ],
          martes: [ { inicio: 6.5, fin: 11 }, { inicio: 13, fin: 17 } ],
          miercoles: [ { inicio: 6.5, fin: 11 }, { inicio: 13, fin: 17 } ],
          jueves: [ { inicio: 6.5, fin: 11 }, { inicio: 13, fin: 17 } ],
          viernes: [ { inicio: 6.5, fin: 11 }, { inicio: 13, fin: 16.5 } ]
        },
        telefono: "573175855587"
      },
      {
        nombre: "Edgard Johan",
        apellido: "Trejos Jansasoy",
        horarios: {
          lunes: [ { inicio: 9, fin: 13 }, { inicio: 15.5, fin: 19 } ],
          martes: [ { inicio: 9, fin: 13 }, { inicio: 15.5, fin: 19 } ],
          miercoles: [ { inicio: 9, fin: 13 }, { inicio: 16, fin: 19 } ],
          jueves: [ { inicio: 9, fin: 13 }, { inicio: 16, fin: 19 } ],
          viernes: [ { inicio: 9, fin: 13 }, { inicio: 16, fin: 19 } ],
          sabado: [ { inicio: 6.5, fin: 12.5 } ],
          domingo: [ { inicio: 13, fin: 17 } ]
        },
        telefono: "573187356657"
      },
      {
        nombre: "Edward Felipe",
        apellido: "Mora",
        horarios: {
          lunes: [ { inicio: 7, fin: 12 }, { inicio: 14, fin: 17.5 } ],
          martes: [ { inicio: 7, fin: 12 }, { inicio: 14, fin: 17.5 } ],
          miercoles: [ { inicio: 7, fin: 12 }, { inicio: 14, fin: 17.5 } ],
          jueves: [ { inicio: 7, fin: 12 }, { inicio: 14, fin: 17.5 } ],
          viernes: [ { inicio: 7.5, fin: 12 }, { inicio: 14, fin: 17.5 } ]
        },
        telefono: "573126909921"
      }
    ];

    const AREAS = [
      'AREA DE SERVICIOS GENERALES',
      'AREA DE MANTENIMIENTO',
      'AREA DE SISTEMAS'
    ];

    const USERS = {
      'SISTEMAS': { password: '123456' },
      'SERVICIOSGENERALES': { password: '123456' },
      'MANTENIMIENTO': { password: '123456' },
      'TALENTO HUMANO': { password: '123456' }
    };

    // Duplicar personal por área
    let personal = [];
    let nextId = 1;
    ORIGINAL_PERSONAL.forEach(base => {
      AREAS.forEach(area => {
        personal.push({
          id: nextId++,
          nombre: base.nombre,
          apellido: base.apellido,
          area: area,
          horarios: JSON.parse(JSON.stringify(base.horarios)),
          telefono: base.telefono
        });
      });
    });

    // Variables de estado
    let currentUser = null;
    let selectedArea = null;
    let selectedPerson = null;
    let editing = false;
    let editHorarios = {};

    // Obtener nodos DOM
    const areaContainer = document.getElementById('areaContainer');
    const areaSelection = document.getElementById('areaSelection');
    const areaView = document.getElementById('areaView');
    const backLink = document.getElementById('backLink');
    const areaTitle = document.getElementById('areaTitle');
    const addWorkerForm = document.getElementById('addWorkerForm');
    const workerGrid = document.getElementById('workerGrid');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalInitialsEl = document.getElementById('modalInitials');
    const modalNameEl = document.getElementById('modalName');
    const modalStatusEl = document.getElementById('modalStatus');
    const scheduleSummaryEl = document.getElementById('scheduleSummary');
    const progressBarEl = document.getElementById('progressBar');
    const timeRemainingEl = document.getElementById('timeRemaining');
    const scheduleTableEl = document.getElementById('scheduleTable');
    const editTelefonoInput = document.getElementById('editTelefono');
    const editControlsEl = document.getElementById('editControls');
    const defaultControlsEl = document.getElementById('defaultControls');
    const loginPanel = document.getElementById('loginPanel');
    const loginForm = document.getElementById('loginForm');
    const usernameInput = document.getElementById('usernameInput');
    const passwordInput = document.getElementById('passwordInput');
    const loggedUserSpan = document.getElementById('loggedUser');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginTitle = document.getElementById('loginTitle');
    const logoutSection = document.querySelector('#loginPanel .logout-section');
    const closeLoginBtn = document.querySelector('#loginPanel .close-login');
    const adminBtn = document.getElementById('adminBtn');
    const editBtn = document.getElementById('editBtn');
    const deleteWorkerBtn = document.getElementById('deleteWorkerBtn');

    // Inicialización
    init();

    function init() {
      renderAreaCards();
      areaSelection.style.display = 'block';
      areaView.style.display = 'none';
      backLink.addEventListener('click', e => {
        e.preventDefault();
        selectedArea = null;
        selectedPerson = null;
        editing = false;
        renderMainView();
      });
      addWorkerForm.addEventListener('submit', e => {
        e.preventDefault();
        addWorker();
      });
      adminBtn.addEventListener('click', () => toggleLoginPanel());
      closeLoginBtn.addEventListener('click', () => toggleLoginPanel(false));
      loginForm.addEventListener('submit', e => {
        e.preventDefault();
        handleLogin();
      });
      logoutBtn.addEventListener('click', handleLogout);
      editBtn.addEventListener('click', enterEditMode);
      editControlsEl.querySelector('.save').addEventListener('click', saveEdits);
      editControlsEl.querySelector('.cancel').addEventListener('click', cancelEdits);
      deleteWorkerBtn.addEventListener('click', deleteWorker);
      document.querySelector('#modal .close-modal').addEventListener('click', closeModal);
      modalOverlay.addEventListener('click', e => {
        if (e.target === modalOverlay) closeModal();
      });
      setInterval(() => {
        if (!selectedArea) {
          updateWorkerCards();
        } else {
          updateWorkerCards();
          if (selectedPerson && !editing) updateModal();
        }
      }, 60000);
      renderMainView();
    }

    // Eliminar al trabajador seleccionado de la lista
    function deleteWorker() {
      if (!selectedPerson) return;
      const confirmDelete = confirm('¿Desea eliminar a este trabajador?');
      if (!confirmDelete) return;
      // Filtrar la lista personal para eliminar al trabajador
      personal = personal.filter(p => p.id !== selectedPerson.id);
      // Cerrar el modal y actualizar la vista
      closeModal();
      // Si todavía estamos en la vista de área, volver a renderizar las tarjetas
      renderWorkerCards();
    }

    // Renderizar tarjetas de áreas
    function renderAreaCards() {
      areaContainer.innerHTML = '';
      AREAS.forEach(area => {
        const card = document.createElement('div');
        card.className = 'area-card';
        // Grupo de iconos según área
        const iconGroup = document.createElement('div');
        iconGroup.className = 'area-icon-group';
        if (area === 'AREA DE SERVICIOS GENERALES') {
          // Icono de balde (bucket) de Font Awesome
          const bucket = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          bucket.setAttribute('viewBox', '0 0 448 512');
          bucket.setAttribute('preserveAspectRatio', 'xMidYMid meet');
          const bucketPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          bucketPath.setAttribute('d', 'M96 152l0 8-48 0 0-8C48 68.1 116.1 0 200 0l48 0c83.9 0 152 68.1 152 152l0 8-48 0 0-8c0-57.4-46.6-104-104-104l-48 0C142.6 48 96 94.6 96 152zM0 224c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-5.1 0L388.5 469c-2.6 24.4-23.2 43-47.7 43l-233.6 0c-24.6 0-45.2-18.5-47.7-43L37.1 256 32 256c-17.7 0-32-14.3-32-32z');
          bucket.appendChild(bucketPath);
          // Icono de escoba (broom) de Font Awesome
          const broom = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          broom.setAttribute('viewBox', '0 0 576 512');
          broom.setAttribute('preserveAspectRatio', 'xMidYMid meet');
          const broomPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          broomPath.setAttribute('d', 'M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z');
          broom.appendChild(broomPath);
          iconGroup.appendChild(bucket);
          iconGroup.appendChild(broom);
        } else if (area === 'AREA DE MANTENIMIENTO') {
          // Icono de llave inglesa (wrench) de Font Awesome
          const wrench = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          wrench.setAttribute('viewBox', '0 0 512 512');
          wrench.setAttribute('preserveAspectRatio', 'xMidYMid meet');
          const wrenchPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          wrenchPath.setAttribute('d', 'M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7L336 192c-8.8 0-16-7.2-16-16l0-57.4c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z');
          wrench.appendChild(wrenchPath);
          iconGroup.appendChild(wrench);
        } else if (area === 'AREA DE SISTEMAS') {
          // Icono de monitor/ordenador (desktop) de Font Awesome
          const monitor = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          monitor.setAttribute('viewBox', '0 0 576 512');
          monitor.setAttribute('preserveAspectRatio', 'xMidYMid meet');
          const monitorPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          monitorPath.setAttribute('d', 'M64 0C28.7 0 0 28.7 0 64L0 352c0 35.3 28.7 64 64 64l176 0-10.7 32L160 448c-17.7 0-32 14.3-32 32s14.3 32 32 32l256 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-69.3 0L336 416l176 0c35.3 0 64-28.7 64-64l0-288c0-35.3-28.7-64-64-64L64 0zM512 64l0 224L64 288 64 64l448 0z');
          monitor.appendChild(monitorPath);
          iconGroup.appendChild(monitor);
        }
        card.appendChild(iconGroup);
        const nameSpan = document.createElement('span');
        nameSpan.textContent = area;
        card.appendChild(nameSpan);
        card.addEventListener('click', () => selectArea(area));
        areaContainer.appendChild(card);
      });
    }

    function renderMainView() {
      if (!selectedArea) {
        areaSelection.style.display = 'block';
        areaView.style.display = 'none';
      } else {
        areaSelection.style.display = 'none';
        areaView.style.display = 'block';
        areaTitle.textContent = selectedArea;
        addWorkerForm.style.display = currentUser ? 'block' : 'none';
        renderWorkerCards();
      }
    }

    function selectArea(area) {
      selectedArea = area;
      selectedPerson = null;
      editing = false;
      renderMainView();
    }

    function renderWorkerCards() {
      workerGrid.innerHTML = '';
      const workers = personal.filter(p => p.area === selectedArea);
      workers.forEach(person => {
        const card = document.createElement('div');
        card.className = 'worker-card';
        const initials = document.createElement('div');
        initials.className = 'worker-initials';
        initials.textContent = getInitials(person);
        card.appendChild(initials);
        const name = document.createElement('p');
        name.className = 'worker-name';
        name.textContent = person.nombre;
        card.appendChild(name);
        const surname = document.createElement('p');
        surname.className = 'worker-surname';
        surname.textContent = person.apellido;
        card.appendChild(surname);
        const { isOnShift } = getShiftInfo(person);
        const status = document.createElement('div');
        status.className = 'worker-status';
        status.textContent = isOnShift ? 'En turno' : 'Fuera de turno';
        status.style.background = isOnShift ? '#4caf50' : '#f44336';
        card.appendChild(status);
        const whatsappBtn = document.createElement('button');
        whatsappBtn.className = 'whatsapp-btn';
        // Mostrar sólo texto en el botón para mejorar legibilidad
        whatsappBtn.textContent = 'WhatsApp';
        whatsappBtn.addEventListener('click', e => {
          e.stopPropagation();
          window.open(getWhatsAppLink(person.telefono), '_blank');
        });
        card.appendChild(whatsappBtn);
        card.addEventListener('click', () => openModal(person));
        workerGrid.appendChild(card);
      });
    }

    function updateWorkerCards() {
      if (!selectedArea) return;
      const cards = workerGrid.children;
      const workers = personal.filter(p => p.area === selectedArea);
      for (let i = 0; i < cards.length; i++) {
        const card = cards[i];
        const statusDiv = card.querySelector('.worker-status');
        const { isOnShift } = getShiftInfo(workers[i]);
        statusDiv.textContent = isOnShift ? 'En turno' : 'Fuera de turno';
        statusDiv.style.background = isOnShift ? '#4caf50' : '#f44336';
      }
    }

    function getInitials(person) {
      const n1 = person.nombre.split(' ')[0][0] || '';
      const n2 = person.apellido.split(' ')[0][0] || '';
      return `${n1}${n2}`;
    }

    function getWhatsAppLink(telefono) {
      let num = telefono.replace(/\D/g, '');
      if (!num.startsWith('57')) num = '57' + num;
      return `https://wa.me/${num}`;
    }

    function getShiftInfo(person) {
      const now = new Date();
      const dayIndex = now.getDay();
      const days = ['domingo','lunes','martes','miercoles','jueves','viernes','sabado'];
      const today = days[dayIndex];
      const time = now.getHours() + now.getMinutes() / 60;
      const daySchedules = person.horarios[today] || [];
      let isOnShift = false;
      let currentShiftEnd = null;
      let nextShiftStart = null;
      for (const block of daySchedules) {
        if (time >= block.inicio && time < block.fin) {
          isOnShift = true;
          currentShiftEnd = block.fin;
          break;
        }
        if (block.inicio > time && (nextShiftStart === null || block.inicio < nextShiftStart)) {
          nextShiftStart = block.inicio;
        }
      }
      return { isOnShift, currentShiftEnd, nextShiftStart };
    }

    function openModal(person) {
      selectedPerson = person;
      editing = false;
      editHorarios = {};
      modalOverlay.style.display = 'flex';
      updateModal();
    }

    function closeModal() {
      modalOverlay.style.display = 'none';
      selectedPerson = null;
      editing = false;
      editHorarios = {};
    }

    function updateModal() {
      if (!selectedPerson) return;
      modalInitialsEl.textContent = getInitials(selectedPerson);
      modalNameEl.textContent = `${selectedPerson.nombre} ${selectedPerson.apellido}`;
      const { isOnShift, currentShiftEnd, nextShiftStart } = getShiftInfo(selectedPerson);
      modalStatusEl.textContent = isOnShift ? 'En turno' : 'Fuera de turno';
      modalStatusEl.style.background = isOnShift ? '#4caf50' : '#f44336';
      // Resumen de horarios para hoy
      const now = new Date();
      const days = ['domingo','lunes','martes','miercoles','jueves','viernes','sabado'];
      const today = days[now.getDay()];
      const blocks = selectedPerson.horarios[today] || [];
      scheduleSummaryEl.textContent = '';
      if (blocks.length > 0) {
        let summaryStr = blocks.map(b => `${formatTime(b.inicio)} - ${formatTime(b.fin)}`).join(' y ');
        scheduleSummaryEl.textContent = summaryStr;
        if (!isOnShift && nextShiftStart !== null) {
          scheduleSummaryEl.textContent += `\nPróximo turno: ${capitalize(today)} ${formatTime(nextShiftStart)}`;
        }
      } else {
        scheduleSummaryEl.textContent = 'Sin turno asignado hoy';
      }
      // Progreso
      if (isOnShift && currentShiftEnd !== null) {
        const nowFloat = now.getHours() + now.getMinutes() / 60;
        const currentBlock = selectedPerson.horarios[today].find(b => nowFloat >= b.inicio && nowFloat < b.fin);
        const progress = (nowFloat - currentBlock.inicio) / (currentBlock.fin - currentBlock.inicio);
        progressBarEl.style.width = `${Math.min(Math.max(progress, 0), 1) * 100}%`;
        const remainingMinutes = Math.round((currentBlock.fin - nowFloat) * 60);
        const hrs = Math.floor(remainingMinutes / 60);
        const mins = remainingMinutes % 60;
        timeRemainingEl.textContent = `${hrs}h ${mins}m restantes`;
      } else {
        progressBarEl.style.width = '0%';
        timeRemainingEl.textContent = '';
      }
      // Tabla de horarios
      renderScheduleTable(selectedPerson.horarios, editing);
      // Mostrar controles
      if (editing) {
        defaultControlsEl.style.display = 'none';
        editControlsEl.style.display = 'flex';
        document.getElementById('phoneEdit').style.display = 'block';
        editTelefonoInput.value = selectedPerson.telefono;
      } else {
        editControlsEl.style.display = 'none';
        defaultControlsEl.style.display = currentUser ? 'flex' : 'none';
        document.getElementById('phoneEdit').style.display = 'none';
      }
    }

    function renderScheduleTable(horarios, editable) {
      scheduleTableEl.innerHTML = '';
      const headerRow = document.createElement('tr');
      ['Día','Primera Jornada','Segunda Jornada'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });
      scheduleTableEl.appendChild(headerRow);
      const days = ['lunes','martes','miercoles','jueves','viernes','sabado','domingo'];
      days.forEach(d => {
        const row = document.createElement('tr');
        const dayCell = document.createElement('td');
        dayCell.textContent = capitalize(d);
        row.appendChild(dayCell);
        const blocks = horarios[d] || [];
        for (let i = 0; i < 2; i++) {
          const cell = document.createElement('td');
          const block = blocks[i];
          if (block) {
            if (editable) {
              // Campo editable de inicio y fin
              const startInput = document.createElement('input');
              startInput.type = 'time';
              startInput.value = toTimeInput(block.inicio);
              startInput.dataset.day = d;
              startInput.dataset.index = i;
              startInput.dataset.field = 'inicio';
              startInput.addEventListener('change', handleTimeChange);
              const endInput = document.createElement('input');
              endInput.type = 'time';
              endInput.value = toTimeInput(block.fin);
              endInput.dataset.day = d;
              endInput.dataset.index = i;
              endInput.dataset.field = 'fin';
              endInput.addEventListener('change', handleTimeChange);
              cell.appendChild(startInput);
              cell.appendChild(document.createTextNode(' - '));
              cell.appendChild(endInput);
            } else {
              cell.textContent = `${formatTime(block.inicio)} - ${formatTime(block.fin)}`;
            }
          } else {
            if (editable) {
              // Permitir añadir nuevo bloque
              const addBtn = document.createElement('button');
              addBtn.textContent = '+';
              addBtn.dataset.day = d;
              addBtn.dataset.index = i;
              addBtn.addEventListener('click', handleAddBlock);
              cell.appendChild(addBtn);
            } else {
              cell.textContent = '-';
            }
          }
          row.appendChild(cell);
        }
        scheduleTableEl.appendChild(row);
      });
    }

    function formatTime(value) {
      const hrs = Math.floor(value);
      const mins = Math.round((value - hrs) * 60);
      const d = new Date();
      d.setHours(hrs, mins, 0);
      return d.toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit', hour12: false });
    }
    function capitalize(s) {
      return s.charAt(0).toUpperCase() + s.slice(1);
    }
    function toTimeInput(value) {
      const hrs = Math.floor(value);
      const mins = Math.round((value - hrs) * 60);
      return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
    }

    function handleTimeChange(e) {
      const day = e.target.dataset.day;
      const index = parseInt(e.target.dataset.index);
      const field = e.target.dataset.field;
      const [h, m] = e.target.value.split(':').map(Number);
      const value = h + m / 60;
      if (!editHorarios[day]) editHorarios[day] = [];
      if (!editHorarios[day][index]) editHorarios[day][index] = { inicio: null, fin: null };
      editHorarios[day][index][field] = value;
    }
    function handleAddBlock(e) {
      const day = e.target.dataset.day;
      const index = parseInt(e.target.dataset.index);
      if (!editHorarios[day]) editHorarios[day] = [];
      editHorarios[day][index] = { inicio: 8, fin: 10 };
      selectedPerson.horarios[day] = selectedPerson.horarios[day] || [];
      selectedPerson.horarios[day][index] = { inicio: 8, fin: 10 };
      renderScheduleTable(selectedPerson.horarios, true);
    }

    function enterEditMode() {
      if (!selectedPerson) return;
      editing = true;
      editHorarios = {};
      updateModal();
    }

    function saveEdits() {
      // aplicar cambios en horarios
      for (const d in editHorarios) {
        editHorarios[d].forEach((block, idx) => {
          if (block.inicio != null && block.fin != null) {
            selectedPerson.horarios[d][idx].inicio = block.inicio;
            selectedPerson.horarios[d][idx].fin = block.fin;
          }
        });
      }
      // actualizar teléfono
      selectedPerson.telefono = editTelefonoInput.value;
      editing = false;
      editHorarios = {};
      updateModal();
      updateWorkerCards();
    }

    function cancelEdits() {
      editing = false;
      editHorarios = {};
      updateModal();
    }

    function addWorker() {
      const nombre = document.getElementById('newNombre').value.trim();
      const apellido = document.getElementById('newApellido').value.trim();
      const telefono = document.getElementById('newTelefono').value.trim();
      if (!nombre || !apellido || !telefono) return;
      // copiar horarios del primer trabajador del área
      const sample = personal.find(p => p.area === selectedArea);
      const newHorarios = JSON.parse(JSON.stringify(sample.horarios));
      personal.push({
        id: nextId++,
        nombre,
        apellido,
        area: selectedArea,
        horarios: newHorarios,
        telefono
      });
      document.getElementById('newNombre').value = '';
      document.getElementById('newApellido').value = '';
      document.getElementById('newTelefono').value = '';
      renderWorkerCards();
    }

    function toggleLoginPanel(show) {
      const open = show === undefined ? !loginPanel.classList.contains('open') : show;
      if (open) {
        loginPanel.classList.add('open');
        document.body.style.overflow = 'hidden';
        if (currentUser) {
          loginForm.style.display = 'none';
          logoutSection.style.display = 'flex';
          loggedUserSpan.textContent = currentUser;
          loginTitle.textContent = 'Usuario';
        } else {
          loginForm.style.display = 'flex';
          logoutSection.style.display = 'none';
          loginTitle.textContent = 'Iniciar sesión';
        }
      } else {
        loginPanel.classList.remove('open');
        document.body.style.overflow = '';
      }
    }

    function handleLogin() {
      const user = usernameInput.value.trim().toUpperCase();
      const pass = passwordInput.value.trim();
      if (USERS[user] && USERS[user].password === pass) {
        currentUser = user;
        usernameInput.value = '';
        passwordInput.value = '';
        toggleLoginPanel(false);
        renderMainView();
      } else {
        alert('Usuario o contraseña incorrectos');
      }
    }

    function handleLogout() {
      currentUser = null;
      toggleLoginPanel(false);
      renderMainView();
    }
  </script>
</body>
</html>